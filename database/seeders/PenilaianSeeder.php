<?php

namespace Database\Seeders;

use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;

class PenilaianSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        // Format Data: [Alternatif => [C1, C2, C3, C4, C5]] (Nilai Awal)
        // Nilai terbobot dihitung manual/hardcode sesuai excel agar presisi
        
        // --- DM 1 (U0002) --- [cite: 1, 3]
        $dm1_raw = [
            'A01' => [1, 4, 4, 2, 4], 'A02' => [1, 4, 3, 2, 4], 'A03' => [1, 4, 4, 2, 4],
            'A04' => [1, 4, 3, 2, 4], 'A05' => [1, 3, 3, 2, 5], 'A06' => [1, 2, 3, 2, 4],
            'A07' => [1, 3, 3, 2, 3], 'A08' => [2, 2, 3, 1, 4], 'A09' => [1, 2, 3, 2, 2],
            'A10' => [1, 3, 2, 2, 3]
        ];
        // Nilai Terbobot (Pangkat bobot normalisasi) dari CSV [cite: 3]
        $dm1_weighted = [
            'A01' => [1, 1.3195, 1.2311, 1.1095, 1.4142], 'A02' => [1, 1.3195, 1.1791, 1.1095, 1.4142],
            'A03' => [1, 1.3195, 1.2311, 1.1095, 1.4142], 'A04' => [1, 1.3195, 1.1791, 1.1095, 1.4142],
            'A05' => [1, 1.2457, 1.1791, 1.1095, 1.4953], 'A06' => [1, 1.1486, 1.1791, 1.1095, 1.4142],
            'A07' => [1, 1.2457, 1.1791, 1.1095, 1.3160], 'A08' => [1.1892, 1.1486, 1.1791, 1, 1.4142],
            'A09' => [1, 1.1486, 1.1791, 1.1095, 1.1892], 'A10' => [1, 1.2457, 1.1095, 1.1095, 1.3160],
        ];

        // --- DM 2 (U0003) --- [cite: 4, 6]
        $dm2_raw = [
            'A01' => [1, 4, 4, 2, 5], 'A02' => [1, 4, 3, 2, 5], 'A03' => [1, 4, 4, 2, 3],
            'A04' => [1, 4, 3, 2, 4], 'A05' => [1, 3, 3, 2, 5], 'A06' => [1, 2, 3, 2, 5],
            'A07' => [1, 3, 3, 2, 3], 'A08' => [2, 2, 3, 1, 3], 'A09' => [1, 2, 3, 2, 2],
            'A10' => [1, 3, 2, 2, 3]
        ];
        // Note: A1 C5 is 5 (1.4953), A3 C5 is 3 (1.3160)
        $dm2_weighted = [
            'A01' => [1, 1.3195, 1.2311, 1.1095, 1.4953], 'A02' => [1, 1.3195, 1.1791, 1.1095, 1.4953],
            'A03' => [1, 1.3195, 1.2311, 1.1095, 1.3160], 'A04' => [1, 1.3195, 1.1791, 1.1095, 1.4142],
            'A05' => [1, 1.2457, 1.1791, 1.1095, 1.4953], 'A06' => [1, 1.1486, 1.1791, 1.1095, 1.4953],
            'A07' => [1, 1.2457, 1.1791, 1.1095, 1.3160], 'A08' => [1.1892, 1.1486, 1.1791, 1, 1.3160],
            'A09' => [1, 1.1486, 1.1791, 1.1095, 1.1892], 'A10' => [1, 1.2457, 1.1095, 1.1095, 1.3160],
        ];

        // --- DM 3 (U0004) --- [cite: 7, 9]
        $dm3_raw = [
            'A01' => [1, 4, 4, 2, 5], 'A02' => [1, 4, 3, 2, 5], 'A03' => [1, 4, 4, 2, 4],
            'A04' => [1, 4, 3, 2, 5], 'A05' => [1, 3, 3, 2, 4], 'A06' => [1, 2, 3, 2, 4],
            'A07' => [1, 3, 3, 2, 3], 'A08' => [2, 2, 3, 1, 4], 'A09' => [1, 2, 3, 2, 3],
            'A10' => [1, 3, 2, 2, 4]
        ];
        $dm3_weighted = [
            'A01' => [1, 1.3195, 1.2311, 1.1095, 1.4953], 'A02' => [1, 1.3195, 1.1791, 1.1095, 1.4953],
            'A03' => [1, 1.3195, 1.2311, 1.1095, 1.4142], 'A04' => [1, 1.3195, 1.1791, 1.1095, 1.4953],
            'A05' => [1, 1.2457, 1.1791, 1.1095, 1.4142], 'A06' => [1, 1.1486, 1.1791, 1.1095, 1.4142],
            'A07' => [1, 1.2457, 1.1791, 1.1095, 1.3160], 'A08' => [1.1892, 1.1486, 1.1791, 1, 1.4142],
            'A09' => [1, 1.1486, 1.1791, 1.1095, 1.3160], 'A10' => [1, 1.2457, 1.1095, 1.1095, 1.4142],
        ];

        $this->insertPenilaian('U0002', $dm1_raw, $dm1_weighted);
        $this->insertPenilaian('U0003', $dm2_raw, $dm2_weighted);
        $this->insertPenilaian('U0004', $dm3_raw, $dm3_weighted);
    }

    private function insertPenilaian($userId, $rawData, $weightedData)
    {
        $data = [];
        foreach ($rawData as $altKey => $scores) {
            foreach ($scores as $index => $score) {
                $kriteriaId = 'C' . ($index + 1);
                $data[] = [
                    'id_user' => $userId,
                    'id_alt' => $altKey,
                    'id_kriteria' => $kriteriaId,
                    'nilai_awal' => $score,
                    'nilai_terbobot' => $weightedData[$altKey][$index],
                ];
            }
        }
        DB::table('penilaian')->insert($data);
    }
}
